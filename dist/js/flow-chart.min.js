/*! flow.chart.js - 2014-09-07 */var flow=function(a,b,c){"use strict";a.Util={};var d=a.Util,e=new Mottle;return d.count=1,d.getUniqueID=function(a){return a=a.replace(/\s/g,""),a+"-"+d.count++},d.isEmptyObject=function(a){return 0===Object.keys(a).length},d.triggerEvent=function(a,b){var c=new Event(a,{view:window,bubbles:!0,cancelable:!0});return b.dispatchEvent(c)},d.trigger=function(a,b){return e.trigger(b,a),this},d.on=function(){return 3===arguments.length?e.on(arguments[0],arguments[1],arguments[2]):4===arguments.length?this.elementAddDelegatedEvent(arguments[0],arguments[1],arguments[2],arguments[3]):console.log("called On method with wrong number of arguments"),this},d.extend=function(a,b){return c.extend(a,b)},d.elementAddDelegatedEvent=function(a,b,c,d){var e=this;a.addEventListener(b,function(b){for(var f=b.target,g=!0;!e.elementMatches(f,c);){if(!f||f.isEqualNode(a)){g=!1;break}f=f.parentNode}g&&d.call(f,b)},!1)},d.remove=function(a){return e.remove(a),this},d.isFunction=function(a){return c.isFunction(a)},d.invokeAllFunctions=function(a){Object.getOwnPropertyNames(a).forEach(function(b){"function"==typeof a[b]&&a[b]()})},d.elementMatches=function(a,c){var d=b.body.matchesSelector||b.body.webkitMatchesSelector||b.body.mozMatchesSelector||b.body.msMatchesSelector||b.body.webkitMatchesSelector||b.body.matchesSelector;return a&&d.call(a,c)},d.isNumber=function(a){return c.isNumber(a)},a}(flow||{},document,jsPlumbUtil),flow=function(a){"use strict";var b=a.Util,c=[],d=[];return a.State={cleanState:function(){c=[],d=[]},pushShapeAlteration:function(b){var d={};d[a.Const.SHAPE_EVENT.ALTERATED]=a.getShapeData(b),c.push(d)},pushShapeDeletion:function(d){var e={};e[Const.SHAPE_EVENT.DELETED]=b.extend(a.getShapeData(d),{connectionsTargets:this._getShapeTargetsOfShapeConnections(d)},{connectionsSources:this._getShapeSourcesOfShapeConnections(d)}),c.push(e)},pushShapeCreated:function(b){var c=c,d=b.parent().attr("data-flow-id"),e={};e[d]={},e[d][this.SHAPE_CREADTED]=a.ShapeHandler.getShapeData(b),c.push(e)},_getShapeTargetsOfShapeConnections:function(a){for(var b=jsPlumb.getConnections({source:a}),c=[],d=0;d<b.length;d++)c.push({id:b[d].target.getAttribute("data-flow-id"),label:$(b[d].getLabel()).text()});return c},_getShapeSourcesOfShapeConnections:function(a){for(var b=jsPlumb.getConnections({target:a}),c=[],d=0;d<b.length;d++)c.push({id:b[d].source.getAttribute("data-flow-id"),label:$(b[d].getLabel()).text()});return c},pushConnectionAlteration:function(a){var b=a.idFlowchart,c={};c[b]={},c[b][this.CONNECTION_ALTERATION]=a,c.push(c)},revert:function(){var a=c.pop();void 0!==a&&this._routeReversion(a)},undoRevert:function(a){var b=(a.getAttribute("data-flow-id"),d.pop());void 0!==b&&this._routeReversion(b)},_routeReversion:function(b){if(b[a.Const.SHAPE_EVENT.ALTERATED]){var c=b[a.Const.SHAPE_EVENT.ALTERATED];this._revertShapeState(c)}else b[this.SHAPE_DELETION]?_revertShapeState(b[this.SHAPE_DELETION]):b[this.SHAPE_CREADTED]?_revertShapeCreation(b[this.SHAPE_CREADTED]):b[this.CONNECTION_ALTERATION]&&_revertConnectionAlteration(b[this.CONNECTION_ALTERATION])},_revertShapeState:function(b){var c=a.findShapeById(b.id);null!==c?this._revertShapeAlteration(c,b):this._revertShapeDeletion(b)},_revertShapeCreation:function(b){var c=a.ShapeHandler,d=c.findShapeById(b.id);c.ajaxDelete(d[0]),d.remove()},_revertShapeAlteration:function(a,b){this._setShapeProperties(a,b),jsPlumb.repaint(a)},_revertShapeDeletion:function(b){var c=a.getShapeCloneByType(b.type),d=a.getCurrentDiagram();d.appendChild(c),this._setShapeProperties(c,b),a.makeShapeDraggable(c,b)},_remakeConnections:function(b,c,d){var e=a.ShapeHandler,f=b.parent(),g=c.length;if(g>0)for(var h=0;g>h;h++){var i=c[h],j=e.findShapeById(i.id),k=jsPlumb.connect({source:b,target:j});e.setConnectionLabel(k,i.label,f),e.ajaxSetConnection(b[0],j[0],i.label)}var l=d.length;if(l>0)for(var h=0;l>h;h++){var m=d[h],n=e.findShapeById(m.id),k=jsPlumb.connect({source:n,target:b});e.setConnectionLabel(k,m.label,f),e.ajaxSetConnection(n[0],b[0],m.label)}},_revertConnectionState:function(b){var c=a.ShapeHandler,d=c.findShapeById(b.sourceId),e=c.findShapeById(b.targetId),f=""!==b.value?b.value:"",g=jsPlumb.connect({source:d,target:e}),h=d.parent();c.setConnectionLabel(g,f,d.parent(),h),c.ajaxSetConnection(g.source,g.target,f)},_revertConnectionAlteration:function(b){var c=b.createdConnectionInfo,d=b.deletedConnectionInfo;void 0!==c&&a.ShapeHandler.deleteConnection(c.source,c.target),void 0!==d&&(jsPlumb.connect({source:d.source,target:d.target}),a.ShapeHandler.ajaxSetConnection(d.source,d.target,d.value))},_setShapeProperties:function(a,b){if(b.width||b.height){var c=a.querySelector(".shape.image");c.style.width=b.width,c.style.height=b.height}b.code&&(a.querySelector("code").textContent=b.code),a.style.top=b.top,a.style.left=b.left,a.setAttribute("data-flow-shape-id",b.id),a.focus()}},a}(flow||{}),flow=function(a,b){"use strict";return a.Cache={setCache:function(){var c=a.Cache;c.shapeMenu=b.getElementById("shape-menu"),c.diagramContainer=b.getElementById("right-area"),c.toolbarContainer=b.getElementById("toolbar-container"),c.tabMenuList=c.diagramContainer.querySelector(".flow.tab.list"),c.consoleArea=b.getElementById("console-area"),c.consoleToggle=c.consoleArea.querySelector(".console.toggle.button"),c.consoleExecute=c.consoleArea.querySelector(".console.execution.buttons .execute"),c.consoleDebugStart=c.consoleArea.querySelector(".console.execution.buttons .debug.start"),c.consoleDebugStop=c.consoleArea.querySelector(".console.execution.buttons .debug.stop"),c.consoleDebugNext=c.consoleArea.querySelector(".console.execution.buttons .debug.next"),c.consoleExhibition=c.consoleArea.querySelector(".console.exhibition"),c.consoleExhibitionClean=c.consoleArea.querySelector(".clean"),c.consoleExhibitionContent=c.consoleExhibition.querySelector(".content")}},a}(flow||{},document),flow=function(a,b){"use strict";a.Alerts={};var c=a.Alerts,d=null,e=null;c.showInfoMessage=function(a){f(a,"info")},c.showWarningMessage=function(a){f(a,"warning")},c.showErrorMessage=function(a){f(a,"error")},c.showSuccessMessage=function(a){f(a,"success")},c.confirm=function(a){return window.confirm(a)};var f=function(a,c){var f=[0,.8,.82,.84,.86,.88,.9];window.clearInterval(e),(null===d||null===d.parentNode)&&(d=b.getElementById("alert-messages")),d.setAttribute("data-flow-message-type",c),d.innerHTML="<span>"+a+"</span>",d.style.opacity=1,e=setInterval(function(){d.style.opacity>0?d.style.opacity=f.pop():window.clearTimeout(e)},500)};return a}(flow||{},document),flow=function(a,b){a.setDefaults=function(){d(),c()};var c=function(){var b=a.Cache.diagramContainer.style,c=window.getComputedStyle(a.Cache.diagramContainer.querySelector(".flow.tab.menu")).getPropertyValue("height"),d=window.innerHeight;b.height=d-parseInt(c,10)+"px",window.onresize=function(){d=window.innerHeight,b.height=d-parseInt(c,10)+"px"};var e=a.Cache.shapeMenu,f=e.querySelector("div.shape.display .shape.image"),g=document.createElement("img"),h=e.querySelector("div.shape.manual_input .shape.image"),i=document.createElement("img");g.src="../src/img/display.gif",g.className="shape image",f.parentNode.replaceChild(g,f),i.src="../src/img/manual_input.png",i.className="shape image",h.parentNode.replaceChild(i,h)},d=function(){var a=b.Defaults,c={fillStyle:"transparent"};a.EndpointStyles=[c,c],a.Endpoints=[["Rectangle",{cssClass:"source-anchor",radius:15}],["Rectangle",{radius:15}]],a.Anchor="AutoDefault",a.Connector="Bezier",a.PaintStyle={gradient:{stops:[[0,"midnightblue"],[1,"black"]]},strokeStyle:"black",lineWidth:6},b.Defaults.ConnectionOverlays=[["Arrow",{width:25,length:25,location:1}]],a.ReattachConnections=!0};return a}(flow||{},jsPlumb),flow=function(a,b,c){"use strict";var d={diagrams:{},data:{}};return a.getShapeData=function(a){for(var b=c.getConnections({source:a}),d={},e=a.querySelector(".shape.image"),f=a.querySelector("code"),g="",h=b.length;h--;){var i=b[h],j=i.target.getAttribute("data-flow-shape-id");d[j]={label:i.getLabel()}}return g=null!==f?f.textContent:a.querySelector("input").value,{id:a.getAttribute("data-flow-shape-id"),type:a.getAttribute("data-flow-shape-type"),top:a.style.top,left:a.style.left,code:g,targetConnections:d,width:e.style.width||null,height:e.style.height||null}},a.getDiagramData=function(b){for(var c=[],d=b.querySelectorAll("div.flow.shape"),e=d.length;e--;){var f=a.getShapeData(d[e]);c.push(f)}return{id:b.id,name:b.getAttribute("data-flow-name"),shapes:c}},a.storeDiagramData=function(a){d.diagrams[a.id]={id:a.id,name:a.name,shapes:a.shapes}},a.getStoredDiagramData=function(a){if(a in d.diagrams)return d.diagrams[a];throw"Diagram "+a+" data not found"},a.getStoredDataFromAllDiagrams=function(){var b=a.getCurrentDiagram();return null!==b&&(d.diagrams[b.id]=a.getDiagramData(b)),d.data.count=a.Util.count,d},a.cleanStoredDiagramData=function(a){if(!(a in d.diagrams))throw"Diagram "+a+" data not found";delete d.diagrams[a]},a.cleanAllDiagramsStoredData=function(){d={diagrams:{},data:{}}},a}(flow||{},document,jsPlumb),flow=function(a,b,c){"use strict";a.Listeners={};var d=a.Listeners,e=(a.Cache,a.Util);d.setupDiagramEvents=function(a){f(a)};var f=function(a){e.on(a,"mouseover",function(a){var b=a.target;b instanceof SVGElement||-1===b.className.indexOf("resize anchor")||c.setDraggable(b.parentNode,!1)}),e.on(a,"mouseout",function(a){var b=a.target;b instanceof SVGElement||-1===b.className.indexOf("resize anchor")||c.setDraggable(b.parentNode,!0)}),g(a)},g=function(a){var b,d,f,g=!1;a.addEventListener("mousedown",function(c){var d=c.target;d instanceof SVGElement||-1===d.className.indexOf("resize anchor")||(b=d,a.addEventListener("mousemove",h))});var h=function(a){var e=a.screenX,h=a.screenY;if(g===!0){var i,j=b.parentNode,k=b.parentNode.querySelector(".shape.image"),l=parseInt(j.style.left,10),m=parseInt(j.style.top,10);k.style.width||(k.style.width=window.getComputedStyle(k).getPropertyValue("width")),k.style.height||(k.style.height=window.getComputedStyle(k).getPropertyValue("height"));var n=parseInt(k.style.width,10),o=parseInt(k.style.height,10),p=b.classList;d>e?(i=d-e,p.contains("left")?(j.style.left=l-i+"px",k.style.width=n+i+"px"):k.style.width=n-i+"px"):e>d&&(i=e-d,p.contains("left")?(j.style.left=l+i+"px",k.style.width=n-i+"px"):k.style.width=n+i+"px"),h>f?(i=h-f,p.contains("bottom")?k.style.height=o+i+"px":(j.style.top=m+i+"px",k.style.height=o-i+"px")):f>h&&(i=f-h,p.contains("bottom")?k.style.height=o-i+"px":(j.style.top=m-i+"px",k.style.height=o+i+"px")),c.repaint(b.parentNode)}g=!0,d=e,f=h};e.on(a,"mouseup",function(){this.removeEventListener("mousemove",h,!1),g=!1})};return a}(flow||{},document,jsPlumb),flow=function(a,b,c){"use strict";a.StaticListeners={};var d=a.StaticListeners,e=a.Cache,f=a.Util;return d._createDiagramClick=function(){f.on(e.toolbarContainer,"click","#create-new-flowchart",function(b){b.preventDefault();var c="New diagram";a.createDiagram(c),a.appendTabItemToDiagramArea(c)})},d._openDiagramsClick=function(){var c=b.getElementById("temp-upload");f.on(e.toolbarContainer,"click","ul.flow.toolbar.list.open.diagram li a",function(b){b.preventDefault();var c=a.Alerts.confirm("This will close all your diagrams WITHOUT saving. Want to proceed?");c&&d.call(this)}),c.addEventListener("change",function(){var b=c.files[0],d=new FileReader;d.onload=function(){var b=d.result;a.openDiagrams(b)},d.readAsText(b)},!1);var d=function(){a.closeAllDiagrams();var b=this.getAttribute("href");switch(b){case"json-file":f.trigger("click",c);break;case"local-storage":var d=a.openLocallyStoredDiagrams();d||a.Alerts.showErrorMessage("No diagrams found in the browser");break;default:var e="Open "+b+" option doesn't exist";throw a.Alerts.showErrorMessage(e),e}}},d._saveDiagramsClick=function(){var b="ul.flow.toolbar.list.save.diagram li a:not(.ignore):not(.click)";f.on(e.toolbarContainer,"click",b,function(b){b.preventDefault();var c=a.getStoredDataFromAllDiagrams(),d=1,e=c.diagrams;for(var f in e)e[f].id=e[f].id+"-"+d++;var g=this.getAttribute("href"),h=JSON.stringify(c);switch(g){case"json-file":var i=this.parentNode,j=window.btoa(unescape(encodeURIComponent(h))),k="data:text/octet-stream;base64,"+j;i.insertAdjacentHTML("beforeEnd",'<a id="temp-link" class="ignore click" href="'+k+'" download="flow.json"></a>');var l=i.querySelector("#temp-link");l.click(),i.removeChild(l);break;case"local-storage":window.localStorage.setItem("flow",h);break;default:var m="Save "+g+" option doesn't exist";throw a.Alerts.showErrorMessage(m),m}a.Alerts.showSuccessMessage("Successfully saved")})},d._tabCloseDiagramClick=function(){f.on(e.diagramContainer,"click",".flow.tab.close",function(){if(a.Alerts.confirm("You really want to delete this flowchart?")){var c=this.getAttribute("data-flow-target"),d=b.getElementById(c);null!==d&&a.closeDiagram(d),a.cleanStoredDiagramData(c),f.remove(this.parentNode)}})},d._tabOpenDiagramClick=function(){f.on(e.diagramContainer,"click","a.flow.tab.link",function(){var c=this.getAttribute("data-flow-target");if(null===b.getElementById(c)){var d=a.getCurrentDiagram();null!==d&&a.closeDiagram(d),a.recreateDiagramFromStoredData(c)}})},d._tabOpenDiagramDoubleClick=function(){f.on(e.diagramContainer,"dblclick","a.flow.tab.link",function(){var a=this.parentNode,c=this.textContent,d=this.cloneNode(),e=!1,f=null;a.removeChild(this),a.insertAdjacentHTML("beforeEnd",'<input id="flow-temp-change-name" type="text" value="'+c+'" />'),f=a.querySelector("#flow-temp-change-name"),f.focus(),f.addEventListener("keyup",function(a){e===!1&&13===a.keyCode&&(e=!0,b(f,d,c))}),f.addEventListener("blur",function(){e===!1&&(e=!0,b(f,d,c))})});var b=function(b,c,d){var e=b.value,f=b.parentNode,g=null;if(f.removeChild(b),g=f.appendChild(c),e.length>3){if(g.textContent=e,f.classList.contains("active")){var h=a.getCurrentDiagram();h.setAttribute("data-flow-name",e),h.setAttribute("title",e)}}else g.textContent=d,a.Alerts.showWarningMessage("Diagram names must contain at least 4 characters");!function(){var a=f.querySelector("span");a.style.display="none",a.offsetHeight,a.style.display="block"}()}},d._consoleToggleButtonClick=function(){var a=null;e.consoleToggle.addEventListener("click",function(){var b=e.consoleArea;window.clearInterval(a),b.style.height||(b.style.height=window.getComputedStyle(b).getPropertyValue("height")),a=b.classList.contains("hidden")?setInterval(function(){var c=parseInt(b.style.height,10);c>0?b.style.height=c-15+"px":window.clearInterval(a)},20):setInterval(function(){var c=parseInt(b.style.height,10);200>c?b.style.height=c+15+"px":window.clearInterval(a)},20),b.classList.toggle("hidden")})},d._activeFlowchartClick=function(){f.on(e.diagramContainer,"click",".diagram.active",function(b){a.UI.unmarkAllShapes(),b.target.classList.contains("diagram")&&a.Selection.unselectElements()})},d._activeFlowchartKeyUp=function(){f.on(e.diagramContainer,"keyup",".diagram.active",function(b){var c=b.target.nodeName.toLowerCase(),d=46===b.keyCode;d&&"input"!==c?a.Selection.deleteSelectedItems():90===b.keyCode&&b.ctrlKey?(a.Alerts.showInfoMessage("Sorry, this feature is not implemented yet."),a.State.revert()):89===b.keyCode&&b.ctrlKey&&a.Alerts.showInfoMessage("Sorry, this feature is not implemented yet.")})},d._shapeClick=function(){f.on(e.diagramContainer,"click",".diagram.active div.shape",function(){})},d._shapeDoubleClicked=function(){f.on(e.diagramContainer,"dblclick",".active.diagram div.shape",function(){"true"===this.getAttribute("data-flow-has-user-text")?a.UI.openShapeInput(this):a.Alerts.showErrorMessage("This shape cannnot contain user input")})},d._executionButtonsClick=function(){f.on(e.consoleExecute,"click",function(){a.ExecutionHandler.triggertExecution()}),f.on(e.consoleDebugStart,"click",function(){a.UI.enableDebugNextButton(),a.UI.enableDebugStopButton(),a.ExecutionHandler.triggerDebug()}),f.on(e.consoleDebugNext,"click",function(){a.ExecutionHandler.executeNext()}),f.on(e.consoleDebugStop,"click",function(){a.ExecutionHandler.stopDebug()})},d._refreshConsoleClick=function(){f.on(e.consoleExhibitionClean,"click",function(){a.UI.cleanConsoleContent()})},d._shapeAltered=function(){var b=a.Const.SHAPE_EVENT.ALTERATED;f.on(e.diagramContainer,b,"div.shape",function(b){var c=b.target;a.State.pushShapeAlteration(c)})},function(){c.bind("beforeDrop",function(d){{var e=b.getElementById(d.sourceId),f=b.getElementById(d.targetId),g=c.getConnections({source:f,target:e}),h=c.getConnections({source:e,target:f});e.getAttribute("data-flow-shape-type"),f.getAttribute("data-flow-shape-type")}return e===f?(a.Alerts.showWarningMessage("Recursive connection isn't allowed"),!1):g.length>0?(a.Alerts.showWarningMessage("Elements already connected"),!1):h.length>0?(a.Alerts.showWarningMessage("Duplicate connections aren't allowed"),!1):!0})}(),function(){var b={gradient:{stops:[[0,"#D95C5C"],[1,"white"]]},strokeStyle:"#D95C5C"};c.bind("click",function(c){var d=a.Selection.getSelectedItem(),e=d&&"connection"===d.type&&d.from===c.sourceId&&d.to===c.targetId;e||(c.setPaintStyle(b),a.Selection.addSelectedConnection(c.sourceId,c.targetId))})}(),function(){c.bind("dblclick",function(b){var c=b.source.getAttribute("data-flow-connection-type");c===a.Const.CONNECTION_TYPE.BOOLEAN?a.UI.openBooleanConnection(b):a.UI.openTextConnection(b)})}(),a}(flow||{},document,jsPlumb),flow=function(a){"use strict";a.Templates={};var b=a.Templates;return b.getShapeInnerInput=function(a){return'<input type="text" value="'+a+'" />'},b.getShapeInnerCode=function(a){return"<code>"+a+"</code>"},b.getConnectionLabel=function(a){return'<span class="flow connection label">'+a+"</span>"},b.getNewDiagram=function(b,c){return void 0===c&&(c=a.Util.getUniqueID(b)),'<div id="'+c+'" class="flow active diagram" title="'+b+'" data-flow-name="'+b+'" tabindex="-1"><span class="hidden-anchor" tabindex="-1">Anchor</span></div>'},b.getTabItem=function(a,b){return'<li class="flow active tab item" data-flow-target="'+a+'"><a class="flow tab link" href="#" data-flow-target="'+a+'" title="Open this diagram">'+b+'</a><span class="flow tab close" data-flow-target="'+a+'" title="Close this diagram"> x</span></li>'},b.getPaginatedDiagramItem=function(a,b){return'<li class="flow pagination item"><a class="flow pagination link" href="#" data-flow-target="'+a+'" >'+b+"</a></li>"},b.getConnectionEmptyInput=function(b){return'<input id="'+b+'" type="text" class="connector-text"  maxlength="'+a.Const.MAX_INPUT_LENGTH+'" />'},b.getConnectionFilledInput=function(b,c,d,e){return"<input id='"+b+"' type='text' value='"+c+"' class='connection label overlay' style='top:"+d+"; left:"+e+";' maxlength='"+a.Const.MAX_INPUT_LENGTH+"' />"},b.getConnectionPlainText=function(a,b,c,d){return"<p id='"+a+"' class='connection label overlay' style='top:"+c+"; left:"+d+";' >"+b+"</p>"},b.getConnectionSelect=function(a,b,c){return"<select id='"+a+"' class='connection label overlay' style='top:"+b+"; left:"+c+";'><option value=''></option><option value='true'>true</option><option value='false'>false</option></select>"},b.getConnectionSelectWithTrueSelected=function(a,b,c){return"<select id='"+a+"' class='connection label overlay' style='top:"+b+"; left:"+c+";'><option value=''></option><option value='true' selected>true</option><option value='false'>false</option></select>"},b.getConnectionSelectWithFalseSelected=function(a,b,c){return"<select id='"+a+"' class='connection label overlay' style='top:"+b+"; left:"+c+";'><option value=''></option><option value='true'>true</option><option value='false' selected>false</option></select>"},a}(flow||{}),flow=function(a){"use strict";var b=a.Alerts;return a.ExecutionHandler={currentNode:null,nextNodeDOM:null,cachedNodes:{},cleanAttributesValues:function(){a.Nodes.cleanVarTable(),this.cachedNodes={},this.currentNode=null,this.nextNodeDOM=null},triggertExecution:function(){this.cleanAttributesValues(),a.Selection.unselectElements(),a.UI.unmarkAllShapes();var c=this.getBeginShape();return null===c?(b.showErrorMessage("Element begin not found"),!1):(this.currentNode=a.Nodes.factory(c),this.nextNodeDOM=this.currentNode.execute(),this.executeAll(),void 0)},executeAll:function(){for(;null!==this.nextNodeDOM;)this.setCurrentNode(),this.nextNodeDOM=this.currentNode.execute();a.UI.markShapeAsExecuted(this.currentNode.selector),a.UI.enableExecutionButtons(),b.showSuccessMessage("Execution complete")},triggerDebug:function(){this.cleanAttributesValues(),a.UI.unmarkAllShapes();var c=this.getBeginShape();return null!==c?(b.showInfoMessage("Debug initiated"),this.currentNode=a.Nodes.factory(c),this.nextNodeDOM=this.currentNode.execute(),a.UI.markShapeAsExecuted(this.currentNode.selector),a.UI.disableExecuteButton(),!0):(b.showErrorMessage("Element begin not found"),!1)},executeNext:function(){a.UI.unmarkShapeAsExecuted(this.currentNode.selector),this.setCurrentNode(),this.nextNodeDOM=this.currentNode.execute(),a.UI.markShapeAsExecuted(this.currentNode.selector),null===this.nextNodeDOM&&(b.showSuccessMessage("Execution complete"),a.UI.disableDebugButtons(),a.UI.enableExecuteButton())},stopDebug:function(){b.showSuccessMessage("Debug canceled"),a.UI.disableDebugButtons(),a.UI.enableExecuteButton(),a.UI.unmarkAllShapes()},setCurrentNode:function(){if(null!==this.nextNodeDOM){var b=this.nextNodeDOM.id;this.cachedNodes.hasOwnProperty(b)?this.currentNode=this.cachedNodes[b]:(this.currentNode=a.Nodes.factory(this.nextNodeDOM),this.cachedNodes[b]=this.currentNode)}},getBeginShape:function(){return a.getCurrentDiagram().querySelector('div.shape[data-flow-shape-type="begin"]')},getDebugNextNode:function(){var a=this.currentNode.getNextNodeSelector$;if(null!==a)return a;throw b.showErrorMessage("End of the algorithm"),"End of the algorithm"}},a}(flow,document),flow=function(a,b){"use strict";return a.UI={appendContentToConsole:function(b){a.Cache.consoleExhibitionContent.insertAdjacentHTML("beforeEnd","<code>"+b+"</code><br>"),a.Cache.consoleExhibition.scrollTop=a.Cache.consoleExhibition.scrollHeight},cleanConsoleContent:function(){a.Cache.consoleExhibitionContent.textContent=""},enableExecutionButtons:function(){this.disableExecutionButtons(),this.enableExecuteButton(),this.enableDebugButton()},disableExecutionButtons:function(){this.disableExecuteButton(),this.disableDebugButton(),this.disableDebugNextButton(),this.disableDebugStopButton()},disableDebugButtons:function(){this.disableDebugNextButton(),this.disableDebugStopButton(),this.enableDebugButton()},enableDebugNextButton:function(){a.Cache.consoleDebugNext.removeAttribute("disabled")},disableDebugNextButton:function(){a.Cache.consoleDebugNext.setAttribute("disabled","disabled")},enableExecuteButton:function(){a.Cache.consoleExecute.removeAttribute("disabled")},disableExecuteButton:function(){a.Cache.consoleExecute.setAttribute("disabled","disabled")},enableDebugStopButton:function(){a.Cache.consoleDebugStop.removeAttribute("disabled")},disableDebugStopButton:function(){a.Cache.consoleDebugStop.setAttribute("disabled","disabled")},enableDebugButton:function(){a.Cache.consoleDebugStart.removeAttribute("disabled")},disableDebugButton:function(){a.Cache.consoleDebugStart.setAttribute("disabled","disabled")},openHelp:function(){a.Cache.$helpTab.addClass("active"),document.getElementById("help-content").style.display="block"},closeHelp:function(){a.Cache.$helpTab.removeClass("active"),document.getElementById("help-content").style.display="none"},openTextConnection:function(c){var d=this.getConnectionHtmlId(c),e=c.getLabel();if(null===e||""===e)c.setLabel(a.Templates.getConnectionEmptyInput(d));else{var f=b.getElementById(d),g=f.textContent;c.setLabel(a.Templates.getConnectionFilledInput(d,g,f.style.top,f.style.left))}this.blurOnConnectionInput(c,g)},blurOnConnectionInput:function(c){var d=this,e=b.getElementById(this.getConnectionHtmlId(c));e.select(),e.focus(),a.Util.on(e,"blur",function(){d.setNewValueOfConnection(c,this)})},openBooleanConnection:function(c){var d=this.getConnectionHtmlId(c),e=b.getElementById(d);c.setLabel(null!==e&&/true/i.test(e.textContent)?a.Templates.getConnectionSelectWithTrueSelected(d,e.style.top,e.style.left):null!==e&&/false/i.test(e.textContent)?a.Templates.getConnectionSelectWithFalseSelected(d,e.style.top,e.style.left):null!==e?a.Templates.getConnectionSelect(d):a.Templates.getConnectionSelect(d)),this.clickOrBlurOnConnectionSelect(c)},clickOrBlurOnConnectionSelect:function(c){var d=this,e=b.getElementById(this.getConnectionHtmlId(c));e.focus(),a.Util.on(e,"blur",function(){d.setNewValueOfConnection(c,this)})},getConnectionHtmlId:function(a){return a.sourceId+"_"+a.targetId},setNewValueOfConnection:function(b,c){var d=c.id,e=c.value;b.setLabel(a.Templates.getConnectionPlainText(d,e,c.style.top,c.style.left))},openShapeInput:function(b){var c=null,d=null,e=null;c=b.querySelector("code"),d=c.textContent.replace(/"/g,"&quot;"),c.outerHTML=a.Templates.getShapeInnerInput(d),e=b.querySelector("input"),e.focus(),e.select();var f=!1;a.Util.on(e,"blur",function(a){f||(f=!0,g.call(this,a))}),a.Util.on(e,"keyup",function(a){13!==a.keyCode||f||(f=!0,g.call(this,a))});var g=function(){var c=this.value;c!==d&&a.Util.trigger(a.Const.SHAPE_EVENT.ALTERATED,b),this.outerHTML=a.Templates.getShapeInnerCode(c)}},markShapeAsSelected:function(a){a.classList.add("selected"),a.focus()},unmarkShapeAsSelected:function(a){a.classList.remove("selected")},unmarkAllShapes:function(){for(var b=a.getCurrentDiagram().querySelectorAll("div.shape.executed, div.shape.invalid"),c=b.length;c--;){var d=b[c];d.classList.remove("invalid"),d.classList.remove("executed")}},markShapeAsExecuted:function(a){a.classList.add("executed"),a.focus()},unmarkShapeAsExecuted:function(a){a.classList.remove("executed")},markShapeAsInvalid:function(a){a.classList.add("invalid"),a.focus()},unmarkShapeAsInvalid:function(a){a.classList.remove("invalid")},markFailure:function(b,c){throw void 0!==c&&this.markShapeAsInvalid(c),a.Alerts.showErrorMessage(b),this.enableExecutionButtons(),b}},a}(flow||{},document),flow=function(a){"use strict";a.Const={};var b=a.Const;return b.MAX_INPUT_LENGTH=30,b.SHAPE_TYPE={PROCESS:"process",DISPLAY:"display",DECISION:"decision",MANUAL_INPUT:"manual_input",CONNECTOR:"connector",BEGIN:"begin",END:"end"},b.DIAGRAM_EVENT={LOADED:"diagram_loaded"},b.SHAPE_EVENT={SELECTED:"shape_selected",MOVED:"shape_moved",DELETED:"shape_deleted",ALTERATED:"shape_altered",CREATED:"shape_created"},b.CONNECTION_EVENT={ALTERED:"connection_altered",SELECTED:"connection_selected"},b.CONNECTION_TYPE={BOOLEAN:"boolean",TEXT:"text"},a}(flow||{}),flow=function(a,b,c){"use strict";a.Selection={};var d=a.Selection,e=null;return d.addSelectedShape=function(b){this.unselectElements(),e={type:"shape",id:b.id},a.UI.markShapeAsSelected(b)},d.addSelectedConnection=function(a,b){this.unselectElements(),e={type:"connection",from:a,to:b}},d.deleteSelectedItems=function(){if(e){if("shape"===e.type){var d=b.getElementById(e.id);a.Util.trigger(a.Const.SHAPE_EVENT.ALTERATED,d),c.detachAllConnections(d),a.Util.remove(d)}else{var f=c.getConnections({source:e.from,target:e.to})[0];c.detach(f)}e=null}},d.getSelectedItem=function(){return e},d.unselectShapes=function(){e&&"shape"===e.type&&(a.UI.unmarkShapeAsSelected(b.getElementById(e.id)),e=null)},d.unselectConnections=function(){if(e&&"connection"===e.type){var a=c.getConnections({source:e.from,target:e.to})[0];a.setPaintStyle(c.Defaults.PaintStyle),e=null}},d.unselectElements=function(){this.unselectShapes(),this.unselectConnections(),e=null,a.UI.unmarkAllShapes()},d.cleanSelection=function(){e=null},a}(flow||{},document,jsPlumb),flow=function(flow,jsPlumb){"use strict";flow.Nodes={varTable:{},factory:function(a){var b=a.getAttribute("data-flow-shape-type");switch(b){case flow.Const.SHAPE_TYPE.PROCESS:return new Process(a);case flow.Const.SHAPE_TYPE.DISPLAY:return new Display(a);case flow.Const.SHAPE_TYPE.MANUAL_INPUT:return new ManualInput(a);case flow.Const.SHAPE_TYPE.DECISION:return new Decision(a);default:return new Node(a)}},cleanVarTable:function(){this.varTable={}}};var Node=function(a){this.selector=a,this.execute=function(){return this.validate(),this.getNextNodeSelector()},this.getParsedContent=function(){},this.getNextNodeSelector=function(){var a=jsPlumb.getConnections({source:this.selector});return a.length>0?a[0].target:null},this.validate=function(){var a=jsPlumb.getConnections({source:this.selector});a.length<1&&"0"!==this.selector.getAttribute("data-flow-max-outputs")&&flow.UI.markFailure("Output flow not found",this.selector)}};Node.prototype={getContent:function(){return this.selector.querySelector("code").textContent}};var Process=function(selector){Node.call(this,selector),this.execute=function(){this.validate();try{eval(this.getParsedContent())}catch(e){flow.log(e),flow.UI.markFailure("Erro de sintaxe",this.selector)}return this.getNextNodeSelector()},this.getParsedContent=function(){for(var a=this.getContent().replace("<-","=").split(/("[^"]*")/),b=0,c=a.length;c>b;b++)/^"[^"]*"$/.test(a[b])?""===a[b]&&delete a[b]:a[b]=a[b].replace(/([a-zA-Z_$][0-9a-zA-Z_$]*)/g," flow.Nodes.varTable.$1 ");return a.join(" ")}};Process.prototype=Object.create(Node.prototype);var Display=function(selector){Node.call(this,selector),this.execute=function(){this.validate();var a=this.getParsedContent(),b="<span style='color: teal;'>"+getExpression(a)+" -> </span>",c=getEvaluatedValue(a);return flow.UI.appendContentToConsole(b+c),this.getNextNodeSelector()};var getExpression=function(a){return a.replace(/flow\.Nodes\.varTable\./g,"")},getEvaluatedValue=function(content){try{var result=eval(content)}catch(e){flow.log(e),flow.UI.markFailure("Syntax error",this.selector)}return!Array.isArray(result)&&(void 0===result||null===result||"string"!=typeof result&&isNaN(result))&&(result="Null"),result};this.getParsedContent=function(){for(var a=this.getContent().split(/("[^"]*")/),b=0,c=a.length;c>b;b++)/^"[^"]*"$/.test(a[b])?""===a[b]&&delete a[b]:a[b]=a[b].replace(/([a-zA-Z_$][0-9a-zA-Z_$]*)/g," flow.Nodes.varTable.$1 ");return a.join(" ")}};Display.prototype=Object.create(Node.prototype);var ManualInput=function(selector){Node.call(this,selector),this.execute=function(){this.validate();try{eval(this.getParsedContent());var varName=this.getContent();flow.Util.isNumber(flow.Nodes.varTable[varName])&&(flow.Nodes.varTable[varName]=parseFloat(flow.Nodes.varTable[varName]))}catch(e){flow.log(e),flow.UI.markFailure("Erro de sintaxe",this.selector)}return this.getNextNodeSelector()},this.getParsedContent=function(){return this.getContent().replace(/([a-zA-Z_$][0-9a-zA-Z_$]*)/," flow.Nodes.varTable.$1 = prompt('Insira o valor de $1');")}};ManualInput.prototype=Object.create(Node.prototype);var Decision=function(selector){Node.call(this,selector),this.execute=function(){this.validate();try{var expressionIsTrue=eval(this.getParsedContent())}catch(e){flow.log(e),flow.UI.markFailure("Erro de sintaxe",this.selector)}return this.getNextNodeSelector(expressionIsTrue)},this.getParsedContent=function(){for(var a=this.getContent().split(/("[^"]*")/),b=0,c=a.length;c>b;b++)/^"[^"]*"$/.test(a[b])?""===a[b]&&delete a[b]:a[b]=a[b].replace(/([a-zA-Z_$][0-9a-zA-Z_$]*)/g," flow.Nodes.varTable.$1 ");return a.join(" ")},this.getNextNodeSelector=function(a){var b=jsPlumb.getConnections({source:this.selector});return a===!0?/true/i.test(b[0].getLabel())?b[0].target:b[1].target:a===!1?/true/i.test(b[0].getLabel())?b[1].target:b[0].target:void flow.UI.markFailure("Execution error",this.selector)},this.validate=function(){var a=jsPlumb.getConnections({source:this.selector});a.length<2&&flow.UI.markFailure("A decision shape needs two output flows",is.selector);for(var b=!1,c=!1,d=0;d<a.length;d++)/true/i.test(a[d].getLabel())?b=!0:/false/i.test(a[d].getLabel())&&(c=!0);b&&c||flow.UI.markFailure("It's necessary to have a <b>true</b> and a <b>false</b> output",this.selector)}};return Decision.prototype=Object.create(Node.prototype),flow}(flow||{},jsPlumb),flow=function(a,b,c){"use strict";
var d=a.Cache,e=!0;a.log=function(){e&&(1===arguments.length?console.log(arguments[0]):2===arguments.length&&console.log(arguments[0],arguments[1]))},a.makeMenuShapesDraggable=function(){var a=d.shapeMenu.querySelectorAll("div.flow.shape");c.draggable(a,{scope:"dragFromMenu",clone:!0})},a.getCurrentDiagram=function(){var a;return function(){return(void 0===a||null===a||null===a.parentNode)&&(a=d.diagramContainer.querySelector("div.flow.active.diagram")),a}}(),a.findShapeById=function(b){return a.getCurrentDiagram().querySelector('div.shape[data-flow-shape-id="'+b+'"]')},a.getShapeCloneByType=function(b){return a.Cache.shapeMenu.querySelector('div.shape[data-flow-shape-type="'+b+'"]').cloneNode(!0)},a.createDiagram=function(b,e){var g=a.getCurrentDiagram();null!==g&&a.closeDiagram(g),d.diagramContainer.insertAdjacentHTML("beforeEnd",a.Templates.getNewDiagram(b,e));var h=a.getCurrentDiagram();return h.scrollTop=h.scrollHeight/3.5,h.scrollLeft=h.scrollWidth/3.5,c.setContainer(h),f(h),a.Listeners.setupDiagramEvents(h),a.UI.enableExecutionButtons(),h},a.closeDiagram=function(b){var d=a.getDiagramData(b);a.storeDiagramData(d),a.Util.remove(b),a.Selection.cleanSelection(),c.detachEveryConnection()},a.openLocallyStoredDiagrams=function(){var b=!1,c=window.localStorage.getItem("flow");return null!==c&&""!==c&&(b=a.openDiagrams(c)),b},a.openDiagrams=function(b){var c={},d={};try{c=JSON.parse(b),d=c.diagrams}catch(e){return a.Alerts.showErrorMessage("Error, invalid data."),a.log(e),!1}a.Util.count=c.data.count+1;for(var f in d){var g=d[f];a.storeDiagramData(g),a.recreateDiagramFromStoredData(g.id)}return!0},a.recreateDiagramFromStoredData=function(b){var c=a.getStoredDiagramData(b);a.cleanStoredDiagramData(b);var e=a.createDiagram(c.name,b),f=d.tabMenuList.querySelector('.flow.tab.item[data-flow-target="'+b+'"]');if(null===f)a.appendTabItemToDiagramArea(c.name);else{var g=d.tabMenuList.querySelector(".flow.tab.item.active");null!==g&&g.classList.remove("active"),f.classList.add("active")}this.createDiagramShapesFromArray(e,c.shapes)},a.createDiagramShapesFromArray=function(a,e){for(var f=b.createDocumentFragment(),g=e.length;g--;){var i=e[g],j=d.shapeMenu.querySelector('div[data-flow-shape-type="'+i.type+'"]'),k=j.cloneNode(!0),l=k.querySelector(".shape.image");f.appendChild(k),k.style.top=i.top,k.style.left=i.left,l.style.height=i.height,l.style.width=i.width,k.querySelector("code").textContent=i.code,k.setAttribute("data-flow-shape-id",i.id),h(k)}a.appendChild(f);var m=a.querySelector(".begin");m&&m.focus(),c.setSuspendDrawing(!0);for(var g=e.length;g--;){var i=e[g],n=a.querySelector('[data-flow-shape-id="'+i.id+'"]'),o=i.targetConnections;for(var p in o){var q=o[p],r=a.querySelector('[data-flow-shape-id="'+p+'"]');c.connect({source:n,target:r,label:q.label||""})}}c.setSuspendDrawing(!1,!0)},a.appendTabItemToDiagramArea=function(b){var c=d.tabMenuList.querySelector(".flow.tab.item.active");null!==c&&c.classList.remove("active"),d.tabMenuList.insertAdjacentHTML("beforeEnd",a.Templates.getTabItem(a.getCurrentDiagram().id,b))},a.closeAllDiagrams=function(){for(a.cleanAllDiagramsStoredData={};d.tabMenuList.hasChildNodes();)d.tabMenuList.removeChild(d.tabMenuList.lastChild);var b=a.getCurrentDiagram();null!==b&&a.closeDiagram(b)},a.makeShapeDraggable=function(b,d){b.removeAttribute("id"),c.draggable(b,{start:function(b){var c=b.el;a.Selection.addSelectedShape(c),a.Util.trigger(a.Const.SHAPE_EVENT.ALTERATED,c)},drag:function(a){return"TODO"}}),d.maxInputs>0?c.makeTarget(b,{maxConnections:d.maxInputs,isTarget:!0}):-1===d.maxOutputs&&c.makeTarget(b,{isTarget:!0}),d.maxOutputs>0?c.makeSource(b,{maxConnections:d.maxOutputs,filter:".connector",isSource:!0}):-1===d.maxOutputs&&c.makeSource(b,{filter:".connector",isSource:!0})};var f=function(b){var d=c._katavorio;d.droppable(b,{scope:"dragFromMenu",drop:function(c){var d=c.drop.el,e=c.drag.el,f=parseInt(e.getAttribute("data-flow-max-copies"),10),i=e.getAttribute("data-flow-shape-type");if(-1===f||g(b,i)<f){var j=e.cloneNode(!0);j.style.left=c.e.layerX+d.scrollLeft+"px",j.style.top=c.e.layerY+d.scrollTop+"px",b.appendChild(j),h(j)}else a.Alerts.showWarningMessage("You cannot create more shapes of this type")}})},g=function(a,b){return a.querySelectorAll('div.shape[data-flow-shape-type="'+b+'"]').length},h=function(b){var c=i(b);a.makeShapeDraggable(b,c),c.secondId||b.setAttribute("data-flow-shape-id",a.Util.getUniqueID(c.type))},i=function(a){var b=a.querySelector("code");return{secondId:a.getAttribute("data-flow-shape-id"),type:a.getAttribute("data-flow-shape-type"),hasUserText:"true"===a.getAttribute("data-flow-has-user-text"),maxOutputs:parseInt(a.getAttribute("data-flow-max-outputs"),10),maxInputs:parseInt(a.getAttribute("data-flow-max-inputs"),10),maxCopies:parseInt(a.getAttribute("data-flow-max-copies"),10),value:null!==b?b.textContent:"",left:a.style.left,top:a.style.top}};return a}(flow||{},document,jsPlumb);jsPlumb.ready(function(){"use strict";flow.Cache.setCache(),flow.setDefaults(),flow.makeMenuShapesDraggable(),flow.Util.invokeAllFunctions(flow.StaticListeners);var a=flow.openLocallyStoredDiagrams();a&&flow.Alerts.showSuccessMessage("Diagrams found in the browser automatically open")});